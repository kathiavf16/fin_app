{"ast":null,"code":"/** \n * Copyright (c) INOVUA SOFTWARE TECHNOLOGIES.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _filter = _interopRequireDefault(require(\"../../filter\"));\n\nvar _paginate = _interopRequireDefault(require(\"../../utils/paginate\"));\n\nvar _getFilterValueForColumns = _interopRequireDefault(require(\"./getFilterValueForColumns\"));\n\nvar _getSortInfoForColumns = _interopRequireDefault(require(\"./getSortInfoForColumns\"));\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar emptyObject = {};\n\nvar filterData = function filterData(data, _ref) {\n  var filterValue = _ref.filterValue,\n      remoteFilter = _ref.remoteFilter,\n      filterTypes = _ref.filterTypes,\n      columnsMap = _ref.columnsMap;\n\n  if (!Array.isArray(filterValue) || !filterValue.length) {\n    return data;\n  }\n\n  if (remoteFilter) {\n    return data;\n  }\n\n  var filterValueForColumns = (0, _getFilterValueForColumns.default)(filterValue, columnsMap);\n\n  if (!filterValueForColumns.length) {\n    return data;\n  }\n\n  return (0, _filter.default)(data, filterValueForColumns, filterTypes, columnsMap);\n};\n\nvar flow = function flow(_ref2) {\n  var originalData = _ref2.originalData,\n      rest = (0, _objectWithoutProperties2.default)(_ref2, [\"originalData\"]);\n\n  var input = _objectSpread(_objectSpread({}, rest), {}, {\n    data: originalData,\n    originalData: originalData,\n    previousData: []\n  });\n\n  for (var _len = arguments.length, transforms = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    transforms[_key - 1] = arguments[_key];\n  }\n\n  return transforms.reduce(function (acc, transform) {\n    acc = transform(acc);\n    acc.previousData.push(acc.data);\n    return acc;\n  }, input);\n};\n\nvar computeData = function computeData(config, computedProps, batchUpdateQueue) {\n  var columnsMap = computedProps.columnsMap;\n  var originalData = config.originalData || computedProps.originalData;\n  var dataCountAfterFilter = undefined;\n  var loading = config.loading === undefined ? computedProps.computedLoading : config.loading;\n  var filterValue = config.filterValue === undefined ? computedProps.computedFilterValue : config.filterValue;\n  var remoteFilter = config.remoteFilter === undefined ? computedProps.computedRemoteFilter : config.remoteFilter;\n  var dataSourceCache = config.dataSourceCache === undefined ? computedProps.computedDataSourceCache : config.dataSourceCache;\n  var filterTypes = computedProps.filterTypes;\n  var localPagination = config.localPagination === undefined ? computedProps.computedLocalPagination : config.localPagination;\n  var remoteData = config.remoteData === undefined ? computedProps.computedRemoteData : config.remoteData;\n  var sortInfo = config.sortInfo === undefined ? computedProps.computedSortInfo : config.sortInfo;\n  var skip = config.skip === undefined ? computedProps.computedSkip : config.skip;\n  var limit = config.limit === undefined ? computedProps.computedLimit : config.limit;\n  var groupBy = config.groupBy === undefined ? computedProps.computedGroupBy : config.groupBy;\n  var treeEnabled = computedProps.computedTreeEnabled;\n  var pivot = computedProps.pivot;\n  var computedSummary = !!computedProps.summaryReducer;\n\n  if (remoteData) {\n    return {\n      data: undefined,\n      dataCountAfterFilter: dataCountAfterFilter\n    };\n  }\n\n  var result = flow({\n    originalData: originalData\n  }, function (config) {\n    if (dataSourceCache && Object.keys(dataSourceCache).length) {\n      config.data = config.data.map(function (item) {\n        var id = computedProps.getItemId(item);\n\n        if (dataSourceCache[id]) {\n          item = _objectSpread(_objectSpread({}, item), dataSourceCache[id]);\n        }\n\n        return item;\n      });\n    }\n\n    return config;\n  }, function (config) {\n    if (filterValue && !computedProps.filterValue) {\n      filterValue = (0, _getFilterValueForColumns.default)(filterValue, columnsMap);\n      config.data = filterData(config.data, {\n        filterValue: filterValue,\n        filterTypes: filterTypes,\n        remoteFilter: remoteFilter,\n        columnsMap: columnsMap\n      });\n      dataCountAfterFilter = config.data.length;\n    }\n\n    return config;\n  }, function (config) {\n    if (!computedProps.sortInfo) {\n      sortInfo = (0, _getSortInfoForColumns.default)(sortInfo, columnsMap);\n\n      if (sortInfo && computedProps.sorty) {\n        config.data = (0, _toConsumableArray2.default)(config.data);\n        computedProps.sorty(sortInfo, config.data);\n      }\n    }\n\n    return config;\n  }, function (config) {\n    if (treeEnabled && computedProps.computeTreeData) {\n      var expandedNodes = computedProps.computedExpandedNodes;\n      config.data = computedProps.computeTreeData(config.data, {\n        expandedNodes: expandedNodes,\n        isNodeLeaf: computedProps.isNodeLeaf,\n        isNodeAsync: computedProps.isNodeAsync,\n        pathSeparator: computedProps.nodePathSeparator,\n        loadingNodes: computedProps.computedLoadingNodes,\n        nodesName: computedProps.nodesProperty,\n        nodeCache: computedProps.computedNodeCache,\n        dataSourceCache: computedProps.computedDataSourceCache,\n        generateIdFromPath: computedProps.generateIdFromPath,\n        collapsingNodes: computedProps.collapsingNodesRef.current\n      });\n    }\n\n    return config;\n  }, function (config) {\n    if (computedSummary) {\n      var summary = computedProps.summaryReducer.initialValue;\n      var reducerFn = computedProps.summaryReducer.reducer || computedProps.summaryReducer.reduce;\n\n      if (summary && (0, _typeof2.default)(summary) === 'object') {\n        summary = _objectSpread({}, summary);\n      }\n\n      var data = config.data;\n      var item;\n\n      for (var i = 0, len = data.length; i < len; i++) {\n        item = data[i];\n        summary = reducerFn(summary, item, computedProps);\n      }\n\n      if (computedProps.summaryReducer.complete) {\n        summary = computedProps.summaryReducer.complete(summary, data || [], computedProps);\n      }\n\n      batchUpdateQueue(function () {\n        computedProps.setSummary(summary);\n      });\n    }\n\n    return config;\n  }, function (config) {\n    if (localPagination && limit) {\n      skip = skip || 0;\n      config.data = (0, _paginate.default)(config.data, {\n        skip: skip,\n        limit: limit\n      });\n    }\n\n    return config;\n  }, function (config) {\n    batchUpdateQueue(function () {\n      computedProps.setUngroupedData(config.data);\n    });\n\n    if (Array.isArray(groupBy) && groupBy.length && computedProps.computeDataStep) {\n      config = computedProps.computeDataStep({\n        groupBy: groupBy,\n        batchUpdateQueue: batchUpdateQueue,\n        columnsMap: columnsMap,\n        computedProps: computedProps,\n        config: config\n      });\n    }\n\n    return config;\n  });\n  return {\n    data: result.data,\n    dataCountAfterFilter: dataCountAfterFilter || 0\n  };\n};\n\nvar _default = computeData;\nexports.default = _default;","map":{"version":3,"sources":["/Users/kathiavargas/node_modules/@inovua/reactdatagrid-community/hooks/useDataSource/computeData.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_typeof2","_toConsumableArray2","_defineProperty2","_objectWithoutProperties2","_filter","_paginate","_getFilterValueForColumns","_getSortInfoForColumns","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","emptyObject","filterData","data","_ref","filterValue","remoteFilter","filterTypes","columnsMap","Array","isArray","filterValueForColumns","flow","_ref2","originalData","rest","input","previousData","_len","transforms","_key","reduce","acc","transform","computeData","config","computedProps","batchUpdateQueue","dataCountAfterFilter","undefined","loading","computedLoading","computedFilterValue","computedRemoteFilter","dataSourceCache","computedDataSourceCache","localPagination","computedLocalPagination","remoteData","computedRemoteData","sortInfo","computedSortInfo","skip","computedSkip","limit","computedLimit","groupBy","computedGroupBy","treeEnabled","computedTreeEnabled","pivot","computedSummary","summaryReducer","result","map","item","id","getItemId","sorty","computeTreeData","expandedNodes","computedExpandedNodes","isNodeLeaf","isNodeAsync","pathSeparator","nodePathSeparator","loadingNodes","computedLoadingNodes","nodesName","nodesProperty","nodeCache","computedNodeCache","generateIdFromPath","collapsingNodes","collapsingNodesRef","current","summary","initialValue","reducerFn","reducer","len","complete","setSummary","setUngroupedData","computeDataStep","_default"],"mappings":"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","sourcesContent":["/** \n * Copyright (c) INOVUA SOFTWARE TECHNOLOGIES.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _typeof2 = _interopRequireDefault(require(\"@babel/runtime/helpers/typeof\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime/helpers/toConsumableArray\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _objectWithoutProperties2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));\n\nvar _filter = _interopRequireDefault(require(\"../../filter\"));\n\nvar _paginate = _interopRequireDefault(require(\"../../utils/paginate\"));\n\nvar _getFilterValueForColumns = _interopRequireDefault(require(\"./getFilterValueForColumns\"));\n\nvar _getSortInfoForColumns = _interopRequireDefault(require(\"./getSortInfoForColumns\"));\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nvar emptyObject = {};\n\nvar filterData = function filterData(data, _ref) {\n  var filterValue = _ref.filterValue,\n      remoteFilter = _ref.remoteFilter,\n      filterTypes = _ref.filterTypes,\n      columnsMap = _ref.columnsMap;\n\n  if (!Array.isArray(filterValue) || !filterValue.length) {\n    return data;\n  }\n\n  if (remoteFilter) {\n    return data;\n  }\n\n  var filterValueForColumns = (0, _getFilterValueForColumns.default)(filterValue, columnsMap);\n\n  if (!filterValueForColumns.length) {\n    return data;\n  }\n\n  return (0, _filter.default)(data, filterValueForColumns, filterTypes, columnsMap);\n};\n\nvar flow = function flow(_ref2) {\n  var originalData = _ref2.originalData,\n      rest = (0, _objectWithoutProperties2.default)(_ref2, [\"originalData\"]);\n\n  var input = _objectSpread(_objectSpread({}, rest), {}, {\n    data: originalData,\n    originalData: originalData,\n    previousData: []\n  });\n\n  for (var _len = arguments.length, transforms = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n    transforms[_key - 1] = arguments[_key];\n  }\n\n  return transforms.reduce(function (acc, transform) {\n    acc = transform(acc);\n    acc.previousData.push(acc.data);\n    return acc;\n  }, input);\n};\n\nvar computeData = function computeData(config, computedProps, batchUpdateQueue) {\n  var columnsMap = computedProps.columnsMap;\n  var originalData = config.originalData || computedProps.originalData;\n  var dataCountAfterFilter = undefined;\n  var loading = config.loading === undefined ? computedProps.computedLoading : config.loading;\n  var filterValue = config.filterValue === undefined ? computedProps.computedFilterValue : config.filterValue;\n  var remoteFilter = config.remoteFilter === undefined ? computedProps.computedRemoteFilter : config.remoteFilter;\n  var dataSourceCache = config.dataSourceCache === undefined ? computedProps.computedDataSourceCache : config.dataSourceCache;\n  var filterTypes = computedProps.filterTypes;\n  var localPagination = config.localPagination === undefined ? computedProps.computedLocalPagination : config.localPagination;\n  var remoteData = config.remoteData === undefined ? computedProps.computedRemoteData : config.remoteData;\n  var sortInfo = config.sortInfo === undefined ? computedProps.computedSortInfo : config.sortInfo;\n  var skip = config.skip === undefined ? computedProps.computedSkip : config.skip;\n  var limit = config.limit === undefined ? computedProps.computedLimit : config.limit;\n  var groupBy = config.groupBy === undefined ? computedProps.computedGroupBy : config.groupBy;\n  var treeEnabled = computedProps.computedTreeEnabled;\n  var pivot = computedProps.pivot;\n  var computedSummary = !!computedProps.summaryReducer;\n\n  if (remoteData) {\n    return {\n      data: undefined,\n      dataCountAfterFilter: dataCountAfterFilter\n    };\n  }\n\n  var result = flow({\n    originalData: originalData\n  }, function (config) {\n    if (dataSourceCache && Object.keys(dataSourceCache).length) {\n      config.data = config.data.map(function (item) {\n        var id = computedProps.getItemId(item);\n\n        if (dataSourceCache[id]) {\n          item = _objectSpread(_objectSpread({}, item), dataSourceCache[id]);\n        }\n\n        return item;\n      });\n    }\n\n    return config;\n  }, function (config) {\n    if (filterValue && !computedProps.filterValue) {\n      filterValue = (0, _getFilterValueForColumns.default)(filterValue, columnsMap);\n      config.data = filterData(config.data, {\n        filterValue: filterValue,\n        filterTypes: filterTypes,\n        remoteFilter: remoteFilter,\n        columnsMap: columnsMap\n      });\n      dataCountAfterFilter = config.data.length;\n    }\n\n    return config;\n  }, function (config) {\n    if (!computedProps.sortInfo) {\n      sortInfo = (0, _getSortInfoForColumns.default)(sortInfo, columnsMap);\n\n      if (sortInfo && computedProps.sorty) {\n        config.data = (0, _toConsumableArray2.default)(config.data);\n        computedProps.sorty(sortInfo, config.data);\n      }\n    }\n\n    return config;\n  }, function (config) {\n    if (treeEnabled && computedProps.computeTreeData) {\n      var expandedNodes = computedProps.computedExpandedNodes;\n      config.data = computedProps.computeTreeData(config.data, {\n        expandedNodes: expandedNodes,\n        isNodeLeaf: computedProps.isNodeLeaf,\n        isNodeAsync: computedProps.isNodeAsync,\n        pathSeparator: computedProps.nodePathSeparator,\n        loadingNodes: computedProps.computedLoadingNodes,\n        nodesName: computedProps.nodesProperty,\n        nodeCache: computedProps.computedNodeCache,\n        dataSourceCache: computedProps.computedDataSourceCache,\n        generateIdFromPath: computedProps.generateIdFromPath,\n        collapsingNodes: computedProps.collapsingNodesRef.current\n      });\n    }\n\n    return config;\n  }, function (config) {\n    if (computedSummary) {\n      var summary = computedProps.summaryReducer.initialValue;\n      var reducerFn = computedProps.summaryReducer.reducer || computedProps.summaryReducer.reduce;\n\n      if (summary && (0, _typeof2.default)(summary) === 'object') {\n        summary = _objectSpread({}, summary);\n      }\n\n      var data = config.data;\n      var item;\n\n      for (var i = 0, len = data.length; i < len; i++) {\n        item = data[i];\n        summary = reducerFn(summary, item, computedProps);\n      }\n\n      if (computedProps.summaryReducer.complete) {\n        summary = computedProps.summaryReducer.complete(summary, data || [], computedProps);\n      }\n\n      batchUpdateQueue(function () {\n        computedProps.setSummary(summary);\n      });\n    }\n\n    return config;\n  }, function (config) {\n    if (localPagination && limit) {\n      skip = skip || 0;\n      config.data = (0, _paginate.default)(config.data, {\n        skip: skip,\n        limit: limit\n      });\n    }\n\n    return config;\n  }, function (config) {\n    batchUpdateQueue(function () {\n      computedProps.setUngroupedData(config.data);\n    });\n\n    if (Array.isArray(groupBy) && groupBy.length && computedProps.computeDataStep) {\n      config = computedProps.computeDataStep({\n        groupBy: groupBy,\n        batchUpdateQueue: batchUpdateQueue,\n        columnsMap: columnsMap,\n        computedProps: computedProps,\n        config: config\n      });\n    }\n\n    return config;\n  });\n  return {\n    data: result.data,\n    dataCountAfterFilter: dataCountAfterFilter || 0\n  };\n};\n\nvar _default = computeData;\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}